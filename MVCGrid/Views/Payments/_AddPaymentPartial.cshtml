@model DentalCareManagmentSystem.Application.DTOs.CreatePaymentDto

<div class="modal-header">
    <h5 class="modal-title">Add Payment</h5>
    <button type="button" class="close" data-dismiss="modal">&times;</button>
</div>

<form asp-action="AddPayment" method="post" id="addPaymentForm">
    <div class="modal-body">
        <input type="hidden" asp-for="PatientId" />
        <input type="hidden" asp-for="AppointmentId" />

        <div class="form-group">
            <label>Patient</label>
            <input type="text" class="form-control" value="@ViewBag.PatientName" readonly />
        </div>

        <div class="alert alert-info">
            <strong>Remaining Balance:</strong> @ViewBag.RemainingBalance.ToString("C")
        </div>

        <div class="form-group">
            <label asp-for="Amount">Amount *</label>
            <input asp-for="Amount" class="form-control" type="number" step="0.01" min="0.01" />
            <span asp-validation-for="Amount" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="PaymentDate">Payment Date *</label>
            <input asp-for="PaymentDate" class="form-control" type="date" />
            <span asp-validation-for="PaymentDate" class="text-danger"></span>
        </div>

        <div class="form-group">
            <label asp-for="Notes">Notes</label>
            <textarea asp-for="Notes" class="form-control" rows="3"></textarea>
            <span asp-validation-for="Notes" class="text-danger"></span>
        </div>
    </div>

    <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="submit" class="btn btn-primary">
            <i class="fas fa-save"></i> Save Payment
        </button>
    </div>
</form>

<script>
    $('#addPaymentForm').on('submit', function (e) {
        e.preventDefault();
        var form = $(this);
        
        $.ajax({
            url: form.attr('action'),
            type: 'POST',
            data: form.serialize(),
            success: function (response) {
                if (response.success) {
                    $('#actionModal').modal('hide');
                    showAlert('success', response.message);
                    // Reload payment summary or grid
                    if (typeof refreshPaymentData === 'function') {
                        refreshPaymentData();
                    } else {
                        location.reload();
                    }
                } else {
                    showAlert('danger', response.message);
                }
            },
            error: function () {
                showAlert('danger', 'An error occurred while processing the payment.');
            }
        });
    });
</script>
