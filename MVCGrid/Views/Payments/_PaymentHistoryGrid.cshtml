@model List<DentalCareManagmentSystem.Application.DTOs.PaymentTransactionDto>
@using NonFactors.Mvc.Grid
@using System.Text

@{
    var grid = new Grid<DentalCareManagmentSystem.Application.DTOs.PaymentTransactionDto>(Model)
    {
        Name = "PaymentHistoryGrid",
        Id = "PaymentHistoryGrid",
        EmptyText = "No payment transactions found",
        FilterMode = GridFilterMode.Header
    };

    // Payment Date
    grid.Columns.Add(model => model.PaymentDate)
        .Titled("Payment Date")
        .Formatted("{0:dd/MM/yyyy}")
        .Css("col-payment-date")
        .Filterable(false)
        .Sortable(true);

    // Amount
    grid.Columns.Add(model => model.Amount)
        .Titled("Amount")
        .Formatted("{0:C}")
        .Css("col-amount text-end")
        .Filterable(false)
        .Sortable(true);

    // Notes
    grid.Columns.Add(model => model.Notes)
        .Titled("Notes")
        .Css("col-notes")
        .Filterable(false)
        .Sortable(false);

    // Created By
    grid.Columns.Add(model => model.CreatedByName)
        .Titled("Received By")
        .Css("col-created-by")
        .Filterable(true)
        .Sortable(true);

    // Actions
    if (User.IsInRole("SystemAdmin"))
    {
        grid.Columns.Add(model => model.Id)
            .Titled("Actions")
            .Css("text-center col-actions")
            .Encoded(false)
            .RenderedAs(model => GetActionButtons(model))
            .Filterable(false)
            .Sortable(false);
    }

    grid.Pager = new GridPager<DentalCareManagmentSystem.Application.DTOs.PaymentTransactionDto>(grid)
    {
        PartialViewName = "MvcGrid/_Pager",
        PageSizes = new Dictionary<int, string> { 
            { 10, "10 rows" }, 
            { 20, "20 rows" }, 
            { 50, "50 rows" }
        },
        ShowPageSizes = true,
        RowsPerPage = 10,
        PagesToDisplay = 5
    };
}

@functions {
    string GetActionButtons(DentalCareManagmentSystem.Application.DTOs.PaymentTransactionDto model)
    {
        var sb = new StringBuilder();
        
        sb.Append("<div class='btn-group btn-group-sm'>");
        sb.Append($"<a href='{Url.Action("PrintReceipt", "Payments", new { id = model.Id })}' class='btn btn-info btn-sm' target='_blank' title='Print Receipt'>");
        sb.Append("<i class='fas fa-print'></i>");
        sb.Append("</a>");
        sb.Append($"<button onclick='deletePayment(\"{model.Id}\")' class='btn btn-danger btn-sm' title='Delete Payment'>");
        sb.Append("<i class='fas fa-trash'></i>");
        sb.Append("</button>");
        sb.Append("</div>");
        
        return sb.ToString();
    }
}

@await Html.PartialAsync("MvcGrid/_Grid", grid)

<style>
    .col-payment-date { width: 15%; }
    .col-amount { width: 15%; }
    .col-notes { width: 35%; }
    .col-created-by { width: 20%; }
    .col-actions { width: 15%; }
</style>
